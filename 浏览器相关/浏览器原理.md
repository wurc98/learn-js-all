# 浏览器原理与pwa

1. CPU

中央处理器，串行地一件接一件的处理任务。

cpu在现代电脑上一般有多个核心，8 core，4 core. 核心指的是物理上的概念。

2. GPU

graph,    图形处理器。单个gpu只能处理简单的任务，但是数量特别多，并行计算能力非常强。

3. 进程 & 线程

进程 - 可以把他看做一个被执行的应用程序

线程 - 进程 包含 线程的，一个进程会包含一个或多个线程。

pid processid 

当执行一个应用程序的时候，操作系统会为此程序分配一个进程，会有一块独立的内存空间。
当进程结束的时候，此内存空间会被释放。

## 浏览器架构 

Browser Process （一个）:负责浏览器主体部分，包含导航栏，书签，前进，后退按钮。

Network Process :网络进程，负责页面的网络资源加载。

GPU（一个）: 图像渲染进程，不同的tab是有不同的渲染进程，GPU需要独立在不同的进程之外。

Renderer(多个): 渲染进程，标签内和网易也展示相关的所有工作，html css js 转换为用户可以交互的网页，**默认情况** 下每个tab有
一个独立的渲染过程。

Plugin(多个)：插件进程

### 多线程架构的好处是什么

1. 容错性

不同的tab拥有不同的渲染进程，相互独立，一个tab挂掉不会影响其他的tab进程运行

2. 安全性和沙盒性



### 多线程架构的坏处是什么？

 有些比较 公共 的东西，会在不同的进程空间种存在，就消耗了不必要的内存空间。

 - Chrome是怎么优化这种情况

 限制启动的进程数目，当启动的进程数达到上限后，访问同一个域名的tab都会放在一个进程里。

 - Chrome的服务化

 将某些大的服务拆分成小服务模块，当遇到性能好的设备时，每个服务可以用独立的进程，保证系统的稳定性；当遇到性能不好的设备时，这些服务会被集中在一个进程里，减少内存的消耗

 ### 网站隔离

 iframe 

 当一个tab页存在跨站的iframe，那么这个iframe会拥有一个独立的渲染进程。

 ### 导航时究竟都发生了什么？

 1. url解析
 2. dns查询
 3. tcp链接
 4. 发送http请求 
 5. 接受http请求，响应请求。
 6. 页面渲染
    
    1. 解析html，构建dom树
    2. 解析css,构建css规则树
    3. 合并dom树和css规则树，生成render树
    4. 布局render树
    5. 绘制render树
    6. 浏览器将各层信息发送给GPU,GPU将各层合成，显示在屏幕上。

### 处理输入

UI线程，来判断输入的内容时关键词还是url

### 开始导航 

当用户按下回车的时候，UI进程会通知网络进程来初始化一个网络请求，来获取站点内容。

- 301

网络进程会通知UI进程 进行重定向，然后发起一个网络请求。

- DNS查询时在哪里做的？

网络进程在收到UI线程的通知后开始做的

### 读取响应

1. 响应类型的判断

Content-Type application/json

2. 不同响应类型的处理

* html，浏览器会将获取到的数据交给渲染进程
* 压缩文件/其他类型，会交给下载管理器来处理

3. 安全检查

比如检查是否和已有病毒页面匹配？或者检查是否是跨站数据。

### 寻找一个渲染进程来绘制页面

网络请求的耗时是不固定的，或许会比较长
